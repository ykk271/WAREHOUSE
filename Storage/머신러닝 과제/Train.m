clc; clear;
rng(3);
N = 15;  % Train data 개수 입력
alpha = 0.1;

U = zeros(5, 5, 15);

%%%%%%%%%%%%%%%%%%%%%%%%%
%Train data
U(:,:,1) = [0 1 1 0 0;
            0 0 1 0 0;
            0 0 1 0 0;
            0 0 1 0 0;
            0 1 1 1 0
            ];

U(:,:,2) = [1 1 1 1 0;
            0 0 0 0 1;
            0 1 1 1 0;
            1 0 0 0 0;
            1 1 1 1 1;
            ];
        
U(:,:,3) = [1 1 1 1 0;
            0 0 0 0 1;
            0 1 1 1 0;
            0 0 0 0 1;
            1 1 1 1 0;
            ];
    
U(:,:,4) = [0 0 0 1 0;
            0 0 1 1 0;
            0 1 0 1 0;
            1 1 1 1 1;
            0 0 0 1 0;
            ];
        
U(:,:,5) = [1 1 1 1 1;
            1 0 0 0 0;
            1 1 1 1 0;
            0 0 0 0 1;
            1 1 1 1 0;
            ];
      
U(:,:,6) = [0 0 1 0 0;
            0 0 1 0 0;
            0 0 1 0 0;
            0 0 1 0 0;
            0 0 1 0 0;
            ];
        
U(:,:,7) = [0 1 1 1 0;
            0 0 0 0 1;
            0 0 1 1 0;
            0 1 0 0 0;
            0 1 1 1 1;
            ];
        
U(:,:,8) = [0 1 1 1 0;
            0 0 0 0 1;
            0 1 1 1 0;
            0 0 0 0 1;
            0 1 1 1 0;
            ];
        
U(:,:,9) = [0 0 1 1 0;
            0 1 0 1 0;
            1 0 0 1 0;
            1 1 1 1 1;
            0 0 0 1 0;
            ];
        
U(:,:,10) = [0 1 1 1 1;
             0 1 0 0 0;
             0 1 1 1 0;
             0 0 0 0 1;
             0 1 1 1 0;
            ];
        
U(:,:,11) = [0 0 1 0 0;
             0 1 1 0 0;
             0 0 1 0 0;
             0 0 1 0 0;
             0 1 1 1 0;
             ];
         
U(:,:,12) = [1 1 1 1 1;
             0 0 0 0 1;
             1 1 1 1 1;
             1 0 0 0 0;
             1 1 1 1 1;
             ];
         
U(:,:,13) = [1 1 1 1 1;
             0 0 0 0 1;
             1 1 1 1 1;
             0 0 0 0 1;
             1 1 1 1 1;
             ];
         
U(:,:,14) = [1 0 0 1 0;
             1 0 0 1 0;
             1 0 0 1 0;
             1 1 1 1 1;
             0 0 0 1 0;
             ];
         
U(:,:,15) = [1 1 1 1 1;
             1 0 0 0 0;
             1 1 1 1 1;
             0 0 0 0 1;
             1 1 1 1 1;
             ];    
         
         
Y = [1 0 0 0 0;
     0 1 0 0 0;
     0 0 1 0 0;
     0 0 0 1 0;
     0 0 0 0 1;
     1 0 0 0 0;
     0 1 0 0 0;
     0 0 1 0 0;
     0 0 0 1 0;
     0 0 0 0 1;
     1 0 0 0 0;
     0 1 0 0 0;
     0 0 1 0 0;
     0 0 0 1 0;
     0 0 0 0 1;
     ];               
        
        
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%   
%Weight 초기값 설정

W1 = 2*rand(25,50) - 1;
W2 = 2*rand(50,5) -1;
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%    
%학습
for epoch = 1:10000
for k = 1:N
    u = reshape(U(:,:,k),25,1);
    y = Y(k,:)';
    
       
    z1 = W1'*u;
    x1 = Sigmoid(z1);
    z = W2' * x1;
    yhat = Softmax(z);
    
    e = yhat - y;
    delta = e;
    e_history(:,epoch,k) = e;
    
    e1 = W2*delta;
    delta1 = x1.*(1-x1).*e1;
    
    dW1 = alpha*u*delta1';
    W1 = W1 - dW1;
    
    dW2 = alpha*x1*delta';
    W2 = W2 - dW2;
end
end


for k = 1:N
    u = reshape(U(:,:,k),25,1);
    z1 = W1'*u;
    x1 = Sigmoid(z1);
    z = W2'*x1;
    yhat(:,k) = Softmax(z);
end


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%error morniter
for j = 1:15
a = e_history(:,:,j);

TEXT = sprintf('U%d',j);
subplot(5,3,j);    
for i = 1:5
plot(a(i,1:1000),'LineWidth',1); hold on;
title(TEXT);
end
legend('1','2','3','4','5');
end


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%함수
function y = Sigmoid(x)
y = 1 ./ (1+exp(-x));
end
 

function y = Softmax(x)
ex = exp(x);
y = ex/sum(ex);
end





           
            
        